# GitHub Actions æ‰‹åŠ¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é…ç½®è¯´æ˜

GitHub Actions å·¥ä½œæµå·²é…ç½®ä¸º**ä»…æ‰‹åŠ¨è§¦å‘**ï¼Œä¸ä¼šåœ¨æ¨é€ä»£ç æ—¶è‡ªåŠ¨éƒ¨ç½²ã€‚

### âœ… è§¦å‘æ–¹å¼

#### 1. **workflow_dispatch** - æ‰‹åŠ¨è§¦å‘ï¼ˆç”Ÿäº§éƒ¨ç½²ï¼‰

- åœ¨ GitHub ä»“åº“çš„ Actions é¡µé¢æ‰‹åŠ¨è§¦å‘
- å¯é€‰æ‹©éƒ¨ç½²ç¯å¢ƒï¼ˆproduction æˆ– stagingï¼‰

#### 2. **pull_request** - PR é¢„è§ˆï¼ˆè‡ªåŠ¨ï¼‰

- åˆ›å»ºæˆ–æ›´æ–° Pull Request æ—¶è‡ªåŠ¨è¿è¡Œ
- ç”Ÿæˆé¢„è§ˆéƒ¨ç½² URL
- ä¸å½±å“ç”Ÿäº§ç¯å¢ƒ

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### æ–¹å¼ä¸€ï¼šæœ¬åœ°æ‰§è¡Œ deploy.shï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä¸ä¾èµ– GitHub Actionsï¼š

```bash
# åœ¨æœ¬åœ°è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy.sh

# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run deploy
```

**ä¼˜ç‚¹**:

- âœ… ä¸éœ€è¦é…ç½® GitHub Secrets
- âœ… å³æ—¶éƒ¨ç½²ï¼Œæ— éœ€ç­‰å¾… CI/CD
- âœ… å®Œå…¨æ§åˆ¶éƒ¨ç½²æµç¨‹
- âœ… äº¤äº’å¼ç¡®è®¤

---

### æ–¹å¼äºŒï¼šGitHub UI æ‰‹åŠ¨è§¦å‘

å¦‚æœä½ å·²é…ç½®å¥½ GitHub Secretsï¼Œå¯ä»¥åœ¨ GitHub ç½‘é¡µä¸Šæ‰‹åŠ¨è§¦å‘ï¼š

#### æ­¥éª¤ 1: é…ç½® Secretsï¼ˆé¦–æ¬¡ï¼‰

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ï¼š

```
Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
```

æ·»åŠ ä¸¤ä¸ª secrets:

- `CLOUDFLARE_API_TOKEN` - ä½ çš„ Cloudflare API Token
- `CLOUDFLARE_ACCOUNT_ID` - ä½ çš„ Cloudflare Account ID

#### æ­¥éª¤ 2: æ‰‹åŠ¨è§¦å‘éƒ¨ç½²

1. è¿›å…¥ GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. é€‰æ‹© **"Deploy to Cloudflare Pages"** å·¥ä½œæµ
4. ç‚¹å‡» **"Run workflow"** æŒ‰é’®
5. é€‰æ‹©éƒ¨ç½²ç¯å¢ƒï¼ˆproduction/stagingï¼‰
6. ç‚¹å‡»ç»¿è‰²çš„ **"Run workflow"** ç¡®è®¤

#### æ­¥éª¤ 3: æŸ¥çœ‹è¿›åº¦

- åœ¨ Actions é¡µé¢æŸ¥çœ‹éƒ¨ç½²è¿›åº¦
- ç»¿è‰²å‹¾è¡¨ç¤ºæˆåŠŸ âœ…
- çº¢è‰²å‰è¡¨ç¤ºå¤±è´¥ âŒ

---

## ğŸ”„ å·¥ä½œæµç¨‹å¯¹æ¯”

| éƒ¨ç½²æ–¹å¼           | è§¦å‘æ¡ä»¶     | ä¼˜ç‚¹       | ç¼ºç‚¹             |
| ------------------ | ------------ | ---------- | ---------------- |
| **æœ¬åœ° deploy.sh** | æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ | å¿«é€Ÿã€ç›´æ¥ | éœ€è¦æœ¬åœ°ç¯å¢ƒ     |
| **GitHub Actions** | æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’® | CI/CD é›†æˆ | éœ€è¦é…ç½® Secrets |
| **PR é¢„è§ˆ**        | åˆ›å»º PR è‡ªåŠ¨ | è‡ªåŠ¨é¢„è§ˆ   | ä»…ç”¨äºæµ‹è¯•       |

---

## ğŸ“Š å·¥ä½œæµè¯¦æƒ…

### Quality Check (ä»£ç è´¨é‡æ£€æŸ¥)

**è§¦å‘**: æ‰€æœ‰æƒ…å†µï¼ˆæ‰‹åŠ¨éƒ¨ç½²å’Œ PRï¼‰

**æ£€æŸ¥é¡¹**:

- TypeScript ç±»å‹æ£€æŸ¥
- è¿è¡Œå•å…ƒæµ‹è¯•
- æ£€æŸ¥ console è¯­å¥

### Security Check (å®‰å…¨æ£€æŸ¥)

**è§¦å‘**: æ‰€æœ‰æƒ…å†µ

**æ£€æŸ¥é¡¹**:

- npm audit å®‰å…¨å®¡è®¡
- æ£€æµ‹é«˜å±æ¼æ´

### Deploy (ç”Ÿäº§éƒ¨ç½²)

**è§¦å‘**: ä»…æ‰‹åŠ¨è§¦å‘ `workflow_dispatch`

**æ­¥éª¤**:

1. å®‰è£…ä¾èµ–
2. æ„å»ºé¡¹ç›®
3. éªŒè¯æ„å»ºäº§ç‰©
4. éƒ¨ç½²åˆ° Cloudflare Pages
5. ç”Ÿæˆéƒ¨ç½²æ‘˜è¦

### Preview (é¢„è§ˆéƒ¨ç½²)

**è§¦å‘**: Pull Request

**åŠŸèƒ½**:

- ä¸ºæ¯ä¸ª PR åˆ›å»ºç‹¬ç«‹é¢„è§ˆç¯å¢ƒ
- åœ¨ PR è¯„è®ºä¸­æ˜¾ç¤ºé¢„è§ˆ URL
- è‡ªåŠ¨è·Ÿéš PR æ›´æ–°

---

## ğŸ¯ æ¨èå·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

```bash
# 1. æœ¬åœ°å¼€å‘
npm run dev

# 2. ä¿®æ”¹ä»£ç 
# ... ç¼–è¾‘æ–‡ä»¶ ...

# 3. æäº¤ä»£ç 
git add .
git commit -m "Add feature"
git push

# 4. éƒ¨ç½²ï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰
npm run deploy
```

### å›¢é˜Ÿåä½œ

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# 2. å¼€å‘å®Œæˆååˆ›å»º PR
git push origin feature/new-feature

# 3. åœ¨ GitHub åˆ›å»º Pull Request
# â†’ è‡ªåŠ¨è§¦å‘é¢„è§ˆéƒ¨ç½²

# 4. å®¡æ ¸é€šè¿‡ååˆå¹¶åˆ° main
# â†’ æ‰‹åŠ¨è§¦å‘ç”Ÿäº§éƒ¨ç½²ï¼ˆå¦‚éœ€è¦ï¼‰
```

---

## âš™ï¸ ç¯å¢ƒå‚æ•°

æ‰‹åŠ¨è§¦å‘æ—¶å¯é€‰æ‹©ç¯å¢ƒï¼š

### Productionï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

- éƒ¨ç½²åˆ°ä¸»é¡¹ç›®ï¼š`httping`
- URL: `https://httping.pages.dev`

### Stagingï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰

- éƒ¨ç½²åˆ°æµ‹è¯•é¡¹ç›®ï¼š`httping-staging`
- URL: `https://httping-staging.pages.dev`

> **æ³¨æ„**: éœ€è¦åœ¨ Cloudflare åˆ›å»ºå¯¹åº”çš„é¡¹ç›®

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### æ·»åŠ æ›´å¤šç¯å¢ƒé€‰é¡¹

ç¼–è¾‘ `.github/workflows/deploy.yml`:

```yaml
workflow_dispatch:
  inputs:
    environment:
      type: choice
      options:
        - production
        - staging
        - development # æ·»åŠ æ–°ç¯å¢ƒ
```

### ä¿®æ”¹é¡¹ç›®åç§°

æ ¹æ®é€‰æ‹©çš„ç¯å¢ƒä¿®æ”¹éƒ¨ç½²å‘½ä»¤ï¼š

```yaml
- name: Deploy to Cloudflare Pages
  run: |
    if [ "${{ github.event.inputs.environment }}" == "staging" ]; then
      wrangler pages deploy dist --project-name=httping-staging
    else
      wrangler pages deploy dist --project-name=httping
    fi
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Secrets æœªé…ç½®

**é”™è¯¯**: `Error: Missing required secret`

**è§£å†³**:
ç¡®ä¿å·²åœ¨ä»“åº“è®¾ç½®ä¸­æ·»åŠ :

- `CLOUDFLARE_API_TOKEN`
- `CLOUDFLARE_ACCOUNT_ID`

### é—®é¢˜ 2: å·¥ä½œæµæœªå‡ºç°

**è§£å†³**:

1. ç¡®ä¿ `.github/workflows/deploy.yml` å·²æ¨é€åˆ° GitHub
2. åˆ·æ–° Actions é¡µé¢
3. æ£€æŸ¥ YAML è¯­æ³•æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 3: éƒ¨ç½²å¤±è´¥

**æ£€æŸ¥**:

1. æŸ¥çœ‹ Actions æ—¥å¿—è¯¦æƒ…
2. éªŒè¯ Cloudflare Token æƒé™
3. ç¡®è®¤é¡¹ç›®åç§°æ­£ç¡®

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨æœ¬åœ°éƒ¨ç½²

å¯¹äºå¿«é€Ÿè¿­ä»£ï¼Œå»ºè®®ä½¿ç”¨ `./deploy.sh`:

```bash
npm run deploy
```

### 2. PR ç”¨äºé¢„è§ˆ

ä¸ºé‡å¤§åŠŸèƒ½åˆ›å»º PRï¼Œåˆ©ç”¨è‡ªåŠ¨é¢„è§ˆï¼š

```bash
git checkout -b feature/big-change
# ... å¼€å‘ ...
git push origin feature/big-change
# â†’ åˆ›å»º PR æŸ¥çœ‹é¢„è§ˆ
```

### 3. å®šæœŸæ‰‹åŠ¨éƒ¨ç½²

å¯¹äºç¨³å®šç‰ˆæœ¬ï¼Œé€šè¿‡ GitHub Actions æ‰‹åŠ¨éƒ¨ç½²ï¼š

- è®°å½•å®Œæ•´çš„æ„å»ºæ—¥å¿—
- å›¢é˜Ÿæˆå‘˜å¯è§éƒ¨ç½²å†å²
- ä¾¿äºå®¡è®¡å’Œå›æ»š

### 4. éƒ¨ç½²å‰æ£€æŸ¥

æ— è®ºå“ªç§æ–¹å¼ï¼Œéƒ½å…ˆè¿è¡Œæ£€æŸ¥ï¼š

```bash
npm run deploy:check
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [deploy.sh è„šæœ¬è¯´æ˜](../scripts/README.md)
- [å®Œæ•´éƒ¨ç½²æ–‡æ¡£](../DEPLOYMENT.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](../QUICK_START_DEPLOY.md)

---

## ğŸ“ æ€»ç»“

**å½“å‰é…ç½®**: GitHub Actions **ä¸ä¼š**è‡ªåŠ¨éƒ¨ç½²

**æ¨èæµç¨‹**:

1. æ—¥å¸¸ä½¿ç”¨ `./deploy.sh` æœ¬åœ°éƒ¨ç½²
2. é‡è¦ç‰ˆæœ¬é€šè¿‡ GitHub UI æ‰‹åŠ¨è§¦å‘
3. PR è‡ªåŠ¨ç”Ÿæˆé¢„è§ˆï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

**å…³é”®ä¼˜åŠ¿**:
âœ… å®Œå…¨æ§åˆ¶éƒ¨ç½²æ—¶æœº
âœ… é¿å…æ„å¤–éƒ¨ç½²
âœ… ä¿æŒ PR é¢„è§ˆåŠŸèƒ½
âœ… çµæ´»é€‰æ‹©éƒ¨ç½²æ–¹å¼

---

**æœ€åæ›´æ–°**: 2025-11-20
