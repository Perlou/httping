# è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

æœ¬ç›®å½•åŒ…å«ç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½² Httping åˆ° Cloudflare Pages çš„è„šæœ¬ã€‚

## ğŸ“ è„šæœ¬æ–‡ä»¶

### 1. `deploy.sh` - ä¸»éƒ¨ç½²è„šæœ¬

å…¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ŒåŒ…å«ç¯å¢ƒæ£€æŸ¥ã€æ„å»ºå’Œéƒ¨ç½²åŠŸèƒ½ã€‚

**ä½ç½®**: é¡¹ç›®æ ¹ç›®å½•

**åŠŸèƒ½**:

- âœ… ç¯å¢ƒæ£€æŸ¥ï¼ˆNode.jsã€npmã€Wranglerï¼‰
- âœ… Git çŠ¶æ€æ£€æŸ¥
- âœ… ä¾èµ–å®‰è£…
- âœ… è¿è¡Œæµ‹è¯•
- âœ… é¡¹ç›®æ„å»º
- âœ… éƒ¨ç½²åˆ° Cloudflare Pages
- âœ… å½©è‰²è¾“å‡ºå’Œè¿›åº¦æç¤º

**ä½¿ç”¨æ–¹æ³•**:

```bash
# å®Œæ•´éƒ¨ç½²æµç¨‹ï¼ˆæ¨èï¼‰
./deploy.sh

# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run deploy
```

**å¯ç”¨é€‰é¡¹**:

```bash
./deploy.sh --help              # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./deploy.sh --skip-tests        # è·³è¿‡æµ‹è¯•
./deploy.sh --force             # å¼ºåˆ¶éƒ¨ç½²ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
./deploy.sh --dry-run           # ä»…æ„å»ºï¼Œä¸éƒ¨ç½²
./deploy.sh --clean             # æ¸…ç†é‡è£…ä¾èµ–
```

**npm è„šæœ¬**:

```bash
npm run deploy              # å®Œæ•´éƒ¨ç½²
npm run deploy:force        # å¼ºåˆ¶éƒ¨ç½²
npm run deploy:dry-run      # æµ‹è¯•æ„å»º
```

---

### 2. `scripts/pre-deploy-check.sh` - éƒ¨ç½²å‰æ£€æŸ¥

å…¨é¢çš„ä»£ç è´¨é‡å’Œå®‰å…¨æ£€æŸ¥è„šæœ¬ã€‚

**ä½ç½®**: `scripts/pre-deploy-check.sh`

**æ£€æŸ¥é¡¹**:

- âœ… Git åˆ†æ”¯å’Œæœªæäº¤æ›´æ”¹
- âœ… ä¾èµ–å®Œæ•´æ€§
- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… å•å…ƒæµ‹è¯•
- âœ… æ„å»ºéªŒè¯
- âœ… ç¯å¢ƒæ–‡ä»¶å®‰å…¨
- âœ… npm å®‰å…¨æ¼æ´
- âœ… å¤§å‹æ–‡ä»¶æ£€æµ‹
- âœ… Console è¯­å¥æ£€æŸ¥
- âœ… TODO æ³¨é‡Šç»Ÿè®¡

**ä½¿ç”¨æ–¹æ³•**:

```bash
# ç›´æ¥è¿è¡Œ
./scripts/pre-deploy-check.sh

# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run deploy:check
```

**è¾“å‡ºç¤ºä¾‹**:

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Git åˆ†æ”¯æ£€æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å½“å‰åˆ†æ”¯: main
âœ“ åœ¨ä¸»åˆ†æ”¯ä¸Š

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TypeScript ç±»å‹æ£€æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¿è¡Œ TypeScript ç¼–è¯‘æ£€æŸ¥...
âœ“ TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡

...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ£€æŸ¥æ‘˜è¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å®‰å…¨éƒ¨ç½²ã€‚
```

---

### 3. `.github/workflows/deploy.yml` - GitHub Actions è‡ªåŠ¨éƒ¨ç½²

GitHub Actions å·¥ä½œæµï¼Œå®ç° CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

**ä½ç½®**: `.github/workflows/deploy.yml`

**è§¦å‘æ¡ä»¶**:

- æ¨é€åˆ° `main` åˆ†æ”¯
- Pull Request åˆ›å»ºæˆ–æ›´æ–°
- æ‰‹åŠ¨è§¦å‘

**å·¥ä½œæµç¨‹**:

1. **Quality Check** (ä»£ç è´¨é‡æ£€æŸ¥)

   - TypeScript ç±»å‹æ£€æŸ¥
   - è¿è¡Œæ‰€æœ‰æµ‹è¯•
   - Console è¯­å¥æ£€æŸ¥

2. **Security Check** (å®‰å…¨æ£€æŸ¥)

   - npm audit å®‰å…¨å®¡è®¡

3. **Deploy** (ç”Ÿäº§éƒ¨ç½²)

   - ä»…åœ¨ main åˆ†æ”¯è¿è¡Œ
   - æ„å»ºé¡¹ç›®
   - éƒ¨ç½²åˆ° Cloudflare Pages
   - ç”Ÿæˆéƒ¨ç½²æ‘˜è¦

4. **Preview** (é¢„è§ˆéƒ¨ç½²)
   - ä»…åœ¨ Pull Request è¿è¡Œ
   - éƒ¨ç½²é¢„è§ˆç‰ˆæœ¬
   - åœ¨ PR ä¸­è¯„è®ºé¢„è§ˆ URL

**é¦–æ¬¡è®¾ç½®**:

éœ€è¦åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ Secretsï¼š

1. è¿›å…¥ä»“åº“ **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. æ·»åŠ ä»¥ä¸‹ secrets:

   | Secret åç§°             | è·å–æ–¹å¼                                                         | è¯´æ˜                                |
   | ----------------------- | ---------------------------------------------------------------- | ----------------------------------- |
   | `CLOUDFLARE_API_TOKEN`  | [åˆ›å»º API Token](https://dash.cloudflare.com/profile/api-tokens) | éœ€è¦ "Edit Cloudflare Workers" æƒé™ |
   | `CLOUDFLARE_ACCOUNT_ID` | [Account ID](https://dash.cloudflare.com)                        | åœ¨ Cloudflare Dashboard å³ä¾§æ       |

**æ‰‹åŠ¨è§¦å‘éƒ¨ç½²**:

1. è¿›å…¥ GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. é€‰æ‹© "Deploy to Cloudflare Pages" å·¥ä½œæµ
4. ç‚¹å‡» **Run workflow**

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ¬¡éƒ¨ç½²

```bash
# 1. ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼ˆå·²è‡ªåŠ¨è®¾ç½®ï¼‰
chmod +x deploy.sh scripts/pre-deploy-check.sh

# 2. è¿è¡Œéƒ¨ç½²å‰æ£€æŸ¥
npm run deploy:check

# 3. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œéƒ¨ç½²
npm run deploy
```

### æ—¥å¸¸éƒ¨ç½²æµç¨‹

```bash
# ä¿®æ”¹ä»£ç å
git add .
git commit -m "Update feature"

# éƒ¨ç½²å‰æ£€æŸ¥
npm run deploy:check

# éƒ¨ç½²
npm run deploy

# æˆ–ä¸€é”®éƒ¨ç½²ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
npm run deploy:force
```

### ä»…æµ‹è¯•æ„å»º

```bash
# åªæ„å»ºä¸éƒ¨ç½²
npm run deploy:dry-run
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æƒé™é”™è¯¯

**é”™è¯¯**: `Permission denied: ./deploy.sh`

**è§£å†³**:

```bash
chmod +x deploy.sh scripts/pre-deploy-check.sh
```

### é—®é¢˜ 2: Wrangler æœªå®‰è£…

**é”™è¯¯**: `wrangler: command not found`

**è§£å†³**:

```bash
npm install -g wrangler
```

### é—®é¢˜ 3: éƒ¨ç½²å¤±è´¥

**é”™è¯¯**: Wrangler ç™»å½•æˆ–éƒ¨ç½²å¤±è´¥

**è§£å†³**:

1. é‡æ–°ç™»å½•:

   ```bash
   wrangler logout
   wrangler login
   ```

2. æ£€æŸ¥ API Token (GitHub Actions):
   - ç¡®ä¿å·²è®¾ç½® `CLOUDFLARE_API_TOKEN`
   - ç¡®è®¤ Token æœ‰æ­£ç¡®çš„æƒé™

### é—®é¢˜ 4: GitHub Actions å¤±è´¥

**æ£€æŸ¥æ­¥éª¤**:

1. æŸ¥çœ‹ Actions æ ‡ç­¾ä¸‹çš„é”™è¯¯æ—¥å¿—
2. ç¡®è®¤ Secrets å·²æ­£ç¡®è®¾ç½®
3. æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
4. é‡æ–°è¿è¡Œå·¥ä½œæµ

---

## ğŸ“Š è„šæœ¬å¯¹æ¯”

| ç‰¹æ€§         | deploy.sh | pre-deploy-check.sh | GitHub Actions |
| ------------ | --------- | ------------------- | -------------- |
| **ç¯å¢ƒ**     | æœ¬åœ°      | æœ¬åœ°                | äº‘ç«¯           |
| **äº¤äº’æ€§**   | äº¤äº’å¼    | è‡ªåŠ¨åŒ–              | è‡ªåŠ¨åŒ–         |
| **ä»£ç æ£€æŸ¥** | åŸºç¡€      | å…¨é¢                | å…¨é¢           |
| **å®‰å…¨å®¡è®¡** | å¦        | æ˜¯                  | æ˜¯             |
| **PR é¢„è§ˆ**  | å¦        | å¦                  | æ˜¯             |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿéƒ¨ç½²  | éƒ¨ç½²å‰éªŒè¯          | CI/CD          |

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **éƒ¨ç½²å‰æ£€æŸ¥**: å§‹ç»ˆè¿è¡Œ `npm run deploy:check`
2. **å°æ­¥æäº¤**: é¢‘ç¹æäº¤å°æ”¹åŠ¨ï¼Œä¾¿äºè¿½è¸ªé—®é¢˜
3. **é¢„è§ˆæµ‹è¯•**: ä½¿ç”¨ `--dry-run` éªŒè¯æ„å»º
4. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: æ¨é€åˆ° GitHub è®© Actions è‡ªåŠ¨éƒ¨ç½²
5. **ç›‘æ§æ—¥å¿—**: å…³æ³¨ Cloudflare Pages å’Œ GitHub Actions æ—¥å¿—

---

## ğŸ”— ç›¸å…³èµ„æº

- [ä¸»éƒ¨ç½²æ–‡æ¡£](../DEPLOYMENT.md)
- [Cloudflare Pages æ–‡æ¡£](https://developers.cloudflare.com/pages/)
- [Wrangler æ–‡æ¡£](https://developers.cloudflare.com/workers/wrangler/)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/actions)

---

## ğŸ“ è„šæœ¬ç»´æŠ¤

å¦‚éœ€ä¿®æ”¹è„šæœ¬:

1. æµ‹è¯•æ›´æ”¹: `./deploy.sh --dry-run`
2. éªŒè¯è¯­æ³•: `shellcheck deploy.sh` (éœ€å®‰è£… shellcheck)
3. æ›´æ–°æ–‡æ¡£: åŒæ­¥æ›´æ–°æ­¤ README

---

**æœ€åæ›´æ–°**: 2025-11-20
